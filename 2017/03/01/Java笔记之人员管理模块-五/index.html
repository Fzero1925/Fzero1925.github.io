<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="本篇将完成列表页数据展示，写完后感觉写的比较乱，真的应该把项目完成后再写，但是既然开始了，就得继续写，要不一拖再拖就更写不成了">
<meta property="og:type" content="article">
<meta property="og:title" content="Java笔记之人员管理模块(五)">
<meta property="og:url" content="http://yoursite.com/2017/03/01/Java笔记之人员管理模块-五/index.html">
<meta property="og:site_name" content="Fzero">
<meta property="og:description" content="本篇将完成列表页数据展示，写完后感觉写的比较乱，真的应该把项目完成后再写，但是既然开始了，就得继续写，要不一拖再拖就更写不成了">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4221394-9d2ffaa3e37055eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4221394-db7e513d004ba9bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4221394-b4900fda6947ddf1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4221394-d0dcdb4076a93ff6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-03-19T08:52:27.354Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java笔记之人员管理模块(五)">
<meta name="twitter:description" content="本篇将完成列表页数据展示，写完后感觉写的比较乱，真的应该把项目完成后再写，但是既然开始了，就得继续写，要不一拖再拖就更写不成了">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/4221394-9d2ffaa3e37055eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/03/01/Java笔记之人员管理模块-五/"/>





  <title> Java笔记之人员管理模块(五) | Fzero </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-89586659-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Fzero</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/01/Java笔记之人员管理模块-五/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Fzero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/touxiang.JPG">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Fzero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Fzero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Java笔记之人员管理模块(五)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-01T13:13:27+08:00">
                2017-03-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本篇将完成列表页数据展示，写完后感觉写的比较乱，真的应该把项目完成后再写，但是既然开始了，就得继续写，要不一拖再拖就更写不成了</p>
<a id="more"></a>
<h2 id="最初的列表页"><a href="#最初的列表页" class="headerlink" title="最初的列表页"></a>最初的列表页</h2><p>在这之前，先把列表页建立起来，首先是在StaffAction类中的execute()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//这不是最终版</div><div class="line">public String execute()&#123;</div><div class="line">    List&lt;Staff&gt; staffList = staffService.queryStaffList();</div><div class="line">    HttpServletRequest request = ServletActionContext.getRequest();</div><div class="line">    request.setAttribute(&quot;staffList&quot;, staffList);</div><div class="line">    return SUCCESS;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后是Struts2的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;action name=&quot;list_*&quot; class=&quot;management.action.StaffAction&quot; method=&quot;&#123;1&#125;&quot;&gt;</div><div class="line">	&lt;result &gt;/WEB-INF/jsp/list.jsp&lt;/result&gt;</div><div class="line">	&lt;result name=&quot;input&quot; type=&quot;redirect&quot;&gt;/list&lt;/result&gt;</div><div class="line">&lt;/action&gt;</div></pre></td></tr></table></figure></p>
<p>结合着该<a href="http://www.jianshu.com/p/15a02d676aad" target="_blank" rel="external">系列四</a>最开始的list.jsp页面，基本的列表页就完成了</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4221394-9d2ffaa3e37055eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="列表页"></p>
<p>虽然上面的execute()方法不是最终版，但是那个StaffService调用的queryStaffList()方法是需要的，也在最终版中，在编写单条删除与新增员工的功能的时候，StaffService接口已经被注入StaffAction中了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Autowired</div><div class="line">private StaffService staffService;</div></pre></td></tr></table></figure></p>
<p>然后是在StaffService接口中创建相应的方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 查询所有员工信息</div><div class="line"> * @param staffId</div><div class="line"> * @return</div><div class="line"> */</div><div class="line">List&lt;Staff&gt; queryStaffList();</div></pre></td></tr></table></figure></p>
<p>因为是查询所有的员工信息，所以把返回结果放在List中，接着在StaffServiceImpl类中实现这个接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 查询所有员工信息</div><div class="line"> */</div><div class="line">public List&lt;Staff&gt; queryStaffList() &#123;</div><div class="line">	List&lt;Staff&gt; staffList = staffDao.queryStaffList();</div><div class="line">	return staffList;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在StaffDao接口中创建相应方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 查询所有员工信息</div><div class="line"> * @param staffId</div><div class="line"> * @return</div><div class="line"> */</div><div class="line">List&lt;Staff&gt; queryStaffList();</div></pre></td></tr></table></figure></p>
<p>然后打开mapper目录下的StaffDao.xml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;select id=&quot;queryStaffList&quot; resultType=&quot;Staff&quot;&gt;</div><div class="line">	select id,name,gender,job,salary,email,regdate from staff</div><div class="line">&lt;/select&gt;</div></pre></td></tr></table></figure></p>
<p>返回类型要记得加上，是Staff类</p>
<p>现在，基本的列表页完成了，上面的所有内容，除了execute()方法后面要大改，其余的都可以不用动，接着就要想办法实现分页功能</p>
<h2 id="实现分页功能的思路"><a href="#实现分页功能的思路" class="headerlink" title="实现分页功能的思路"></a>实现分页功能的思路</h2><p>其实整个列表页的数据展示，全部依赖于分页功能</p>
<p>由于是第一次实现分页功能，所以就先去查了下Oracle数据库实现分页的原理，查了半天，觉得这一篇<a href="http://blog.csdn.net/anxpp/article/details/51534006" target="_blank" rel="external">Oracle数据库分页查询原理</a>挺不错的</p>
<blockquote>
<p> Oracle中的表，除了我们建表时设计的各个字段，其实还有两个字段（此处只介绍2个），分别是ROWID（行标示符）和ROWNUM（行号），即使我们使用DESCRIBE命令查看表的结构，也是看不到这两个列的描述的，因为，他们其实是只在数据库内部使用的，所以也通常称他们为伪列（pseudo column）</p>
</blockquote>
<p>可以使用简单的查询语句先验证一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select rowid,rownum,id,name from staff;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/4221394-db7e513d004ba9bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="伪列查询结果"></p>
<blockquote>
<p>这个rowid我们一般用不到，Oracle数据库内部使用它来存储行的物理位置，是一个18位的数字，采用base-64编码<br>而这个rownum，我们也正是使用它来进行分页查询的，它的值，就是表示的该行的行号</p>
</blockquote>
<p>使用伪列的时候还有个小坑，这里就不多说了，刚才那个链接解释的很详细，我再解释也是复制粘贴而已，所以这里就不增加篇幅了，知道了Oracle数据库有伪列这个东西，那就要好好利用了</p>
<p>接着决定在页面采用什么样式，“首页”、“上一页”、“下一页”、用户指定页码的按钮这些功能一定要有，当时感觉也能做出来，但是“上一页”与“下一页”的中间显示什么？</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4221394-b4900fda6947ddf1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分页功能"></p>
<p>这是当时想的样式，本来只想实现1~5的按钮的形式，在js中也是各种实验，但是最后还是放弃了，虽然现在有了点思路，也等到以后实现吧</p>
<p>然后就决定采用“当前页”的形式，但是这种形式必然要把数据全查询一遍，我对于这种需要全查询的情况感觉不太好，现在的数据量何其大，为了分页都要查询一遍？但是最后想通了，就目前我的水平，无论用哪种方式，为了实现分页，都要进行全查询</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4221394-d0dcdb4076a93ff6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分页功能"></p>
<p>这就是最后决定的分页功能的展示形式</p>
<p>那么这五个部分先实现哪个呢？</p>
<blockquote>
<p>我决定从难到易，所以先排除“首页”和GO按钮<br>余下“上一页”、“当前页”、“下一页”，这三部分又以“上一页”最难，但是现在又实现不了，因为连当前是第几页都不知道，所以先从“当前页”开始下手</p>
</blockquote>
<p>实现“当前页”就比较简单了，全查询是肯定要做的，而且是必须做，因为<strong>伪列是根据查询语句的变化而变化的</strong>，伪列是对每一次查询结果进行标注，所以必须要全查询，这样才能获得总页数</p>
<p>有了全查询，总页数的问题解决了，当前页数也好解决，默认是第一页，之后就根据用户的操作了</p>
<p>现在的问题是数据传递的问题，反正我一直是对前后端通信方式有很大的疑惑，从后台获取到了总页数，如何传递到前端页面呢？</p>
<p>最先想到的还是Cookie，但是Cookie会长时间保留，就算直接关闭浏览器，过一段时间再打开，使用F12来查看Cookie，显示的当前页数还不是第一页，也不能清除Cookie，在哪清除？Cookie存在时间多长？这些都不确定</p>
<p>然后就想到execute()方法中的方式，使用HttpServletRequest来设置属性，这样后端的数据可以传递到前端，但是在前端页面如何保存当前页数？用户点击“上一页”或者“下一页”的时候如何获取当前页数？当时前端页面使用的还不是Struts2的标签，也不是jsp页面，而是FreeMarker，这是为了面试而准备的，不过面试也没过，所以最后坚持不下去了，就放弃使用FreeMarker，全部改为jsp页面，使用Struts2的标签</p>
<p>因为在这个过程中一直寻找前后端传递数据的问题，所以在慕课网也看了Struts2和Java的基础视频，也提到了一些，但都是单方向的，ModelDriven就是看Struts2入门视频学到的，还是那句话，<strong>一些东西只有用到的时候，才能看懂</strong>，Struts2入门视频在那之前就看过了，但是还没遇到Struts2接收前端数据的问题，所以也没在意</p>
<p>慕课网也有制作员工管理系统的视频，但是肯定不能再跟着视频一步一步的敲代码，那样很难提高，但是在知道自己出问题的关键点的情况下再去看视频，就会学到很多东西，比如<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt; ActionContext是Action的上下文，Struts2自动在其中保存了一些在Action执行过程中所需的对象，比如session, parameters, locale等。Struts2会根据每个执行HTTP请求的线程来创建对应的ActionContext，即一个线程有一个唯一的ActionContext。因此，使用者可以使用静态方法ActionContext.getContext()来获取当前线程的ActionContext，ActionContext本身的数据结构是映射结构，即一个Map，用key来映射value。所以使用者完全可以像使用Map一样来使用它，或者直接使用Action.getContextMap()方法来对Map进行操作</div><div class="line"></div><div class="line">对于值栈，在这篇[文章](http://www.jianshu.com/p/82954b841b5e#)可以了解的比较详细</div><div class="line"></div><div class="line">简单来说就是</div><div class="line">&gt; 我们可以直接将其理解为一种类似于域对象的用来存值和取值、在页面和后台之间传递数据的功能。在action中将数据存入值栈，然后在页面中通过EL表达式或者OGNL表达式将值取出</div><div class="line"></div><div class="line">知道了如何使用ajax请求并传递参数，知道了如何在Struts2的Action类中接收这些参数，知道了在前端页面如何使用Struts2的标签和OGNL表达式来获取后端存储的数据，接着就是代码的编写</div><div class="line"></div><div class="line">## 分页功能编码</div><div class="line">既然可以使用Struts2的标签来获取值栈中的数据，那么先在前端页面进行更改</div></pre></td></tr></table></figure></p>
<p><li id="li6"><span><br>    当前第<s:property value="currentPage">/<s:property value="sumPage">页<br></s:property></s:property></span></li><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">当前页很容易改动，只是用于显示而已，要记得Struts2标签内value的值，这就是Map中的key</div><div class="line"></div><div class="line">接着是“下一页”</div></pre></td></tr></table></figure></p>
<p><s:if test="currentPage != sumPage"><br>    <a class="btn btn-default" href="/management/list_queryByPage.action?pageNum=<s:property value=" currentpage="" +="" 1"="">"><br>    下一页<br>    </a><br></s:if><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">首先有个判断，如果当前页数不等于总页数的时候，这个“下一页”就会显示出来，如果等于的话，就不会显示。原来是想在js中进行判断的，但是感觉这种方法更好</div><div class="line"></div><div class="line">而且原本是想把传递参数的工作也交给$.post方法，不过无意中看到使用URL传递参数也不错，而且很方便，当然肯定有安全问题，但是不是现在能考虑的，所以暂时先采用URL传递参数的方式</div><div class="line"></div><div class="line">然后是“上一页”</div></pre></td></tr></table></figure></p>
<p><s:if test="currentPage != 1"><br>    <a class="btn btn-default" href="/management/list_queryByPage.action?pageNum=<s:property value=" currentpage="" -="" 1"="">"><br>    上一页<br>    </a><br></s:if><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">这里也进行判断，如果当前页数不等于1，就显示出来</div><div class="line"></div><div class="line">然后是首页</div></pre></td></tr></table></figure></p>
<p><a class="btn btn-default" href="/management/list_queryByPage.action?pageNum=1"><br>    首页<br></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">这里就可以直接赋值为1，使用URL传递参数和使用ajax请求传递参数，在后端都是使用```request.getParameter()```的方式获取的</div><div class="line"></div><div class="line">还有一个输入框和GO按钮，这个就需要写js了，首先在input和button中进行埋点</div></pre></td></tr></table></figure></p>
<p><input type="text" class="form-control" id="inputGo" style="max-width:20%;"><br><span class="input-group-btn"><br>    <button class="btn btn-default" id="go" onclick="go(<s:property value=" sumpage"="">)"><br>        Go<br>    </button><br></span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">button调用go函数并传递总页数</div><div class="line"></div><div class="line">接着在staff.js进行编码</div></pre></td></tr></table></figure></p>
<p>function go(sumPage){<br>    var pageNum = $(‘#inputGo’).val();<br>    if(pageNum == null){<br>        alert(“没有负数页码！！！”);<br>    }else if(pageNum &gt; sumPage){<br>        alert(“没有数据！！！”);<br>    }else if(pageNum &lt; 1){<br>        alert(“没有输入页码！！！”);<br>    }else{<br>        $.post(manage.url.page(“queryByPage”), {“pageNum” : pageNum}, function(){<br>            location.href=”/management/list_queryByPage.action?pageNum=” + pageNum;<br>        });<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">首先对输入框的输入的数据进行判断，然后在使用ajax请求，之前在staff.js中统一封装了所有URL，这次再添加一个</div></pre></td></tr></table></figure></p>
<p>var manage = {</p>
<pre><code>url : {
    list : function(key) {
        return &apos;/management/list_&apos; + key + &apos;.action&apos;;
    },

    addStaff : function(key){
        return &apos;/management/staff_&apos; + key + &apos;.action&apos;;
    },

    page : function(key){
        return &apos;/management/list_&apos; + key + &apos;.action&apos;;
    },

}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">目前就是这么多，以后有其他的再添加</div><div class="line"></div><div class="line">使用ajax请求的时候还要传递参数，并且在回调函数中要刷新页面，这里就有个很大的问题，在传递参数的时候，后台就已经执行了一次queryByPage方法了，在回调函数中刷新的页面也传递了参数，后台也执行了一次，所以一共执行了两次，但是目前这个问题我也没解决，如果回调函数中不写那一句的话，虽然后台执行了一遍queryByPage方法，但是前端页面没有变化，也就是没有跳转的相应的URL</div><div class="line"></div><div class="line">然后就可以开始Action类的编码了</div></pre></td></tr></table></figure></p>
<p>public String queryByPage(){<br>    //获取request对象，获取前端传递过来的Cookie和通过URL传递的参数<br>    HttpServletRequest request = ServletActionContext.getRequest();<br>    //对传递过来的指定页码进行格式转换<br>    int pageNum = Integer.parseInt(request.getParameter(“pageNum”));<br>    //设置将要跳转的页面的第一条数据的伪列号<br>    int pageStart = ((pageNum - 1) * 5) + 1;<br>    //获取全部数据，方便计算总页数<br>    List<staff> staffList = staffService.queryStaffList();<br>    //判断页面第一条数据的伪列号是否小于总行数，如果大于，说明没有相应的数据可以显示，直接返回<br>    if(staffList.size() &gt;= pageStart){<br>        //数据存放在List中，第一个元素为0<br>        pageStart = pageStart - 1;<br>        for(int i = 1; i &lt;= 5; i++){//设置一个页面最多5条信息<br>            //因为之前已经判断页面第一条数据的伪列号小于总行数，所以至少有一条数据<br>            list.add(staffList.get(pageStart));<br>            pageStart = pageStart + 1;<br>            //如果下一条数据的下标等于总行数，说明此时已经没有数据了<br>            if(pageStart == staffList.size()){<br>                break;<br>            }<br>        }<br>    //传递页数和当前页<br>    //1、获取值栈对象<br>    ActionContext context = ActionContext.getContext();<br>    ValueStack stack = context.getValueStack();</staff></p>
<pre><code>//2、调用值栈对象中的set方法
double sumPage = Math.ceil(staffList.size() / 5.0);
//向值栈中设置要传递的参数
stack.set(&quot;sumPage&quot;, (int)sumPage);
stack.set(&quot;currentPage&quot;, pageNum);
return SUCCESS;
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">首先是获取Request对象，接收前端页面使用URL传递参数的方式传递过来的数据，但是使用```request.getParameter()```接收的参数的类型是String，这里转换为int</div><div class="line"></div><div class="line">然后计算出将要跳转的页面的第一条数据的伪列号，这里使用id是不靠谱的</div></pre></td></tr></table></figure></p>
<p>int pageStart = ((pageNum - 1) * 5) + 1;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">比如要跳转到第2页，那么第2页第一条数据的伪列号就是6</div><div class="line"></div><div class="line">然后调用queryStaffList方法获取全部数据，接着对数据的长度进行判断，如果总行数小于页面中第一条数据的伪列号，那就说明没有数据；如果大于，就可以进行数据的添加了</div></pre></td></tr></table></figure></p>
<p>list.add(staffList.get(pageStart));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">之前设置queryStaffList方法返回的是List，这里就体现了好处，可以获取指定的数据，同时把要显示的数据添加到list中，之后再看在前端页面如何获得</div><div class="line"></div><div class="line">如果要取得伪列号为6~10的数据，如果数据库中只有6条数据，那么如果不在循环中加以判断的话 ，会报出空指针异常，所以对接下来的下标进行判断</div></pre></td></tr></table></figure></p>
<p>//如果下一条数据的下标等于总行数，说明此时已经没有数据了<br>if(pageStart == staffList.size()){<br>    break;<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">存储完数据，别忘了还要存储总页数和当前页，使得那么分页的按钮能够发挥作用</div></pre></td></tr></table></figure></p>
<p>//传递页数和当前页<br>//1、获取值栈对象<br>ActionContext context = ActionContext.getContext();<br>ValueStack stack = context.getValueStack();</p>
<p>//2、调用值栈对象中的set方法<br>double sumPage = Math.ceil(staffList.size() / 5.0);<br>//向值栈中设置要传递的参数<br>stack.set(“sumPage”, (int)sumPage);<br>stack.set(“currentPage”, pageNum);<br>return SUCCESS;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">在计算总页数的时候，如果是6/5的话，获得的是1，无法进1，所以使用小数，之后在转换成int型，或者不转换也可以</div><div class="line"></div><div class="line">然后是前端页面如何获取List中的数据</div></pre></td></tr></table></figure></p>
<p><s:iterator value="list" var="s"><br>    <tr><br>        <td><br>            <div class="col-lg-6"><br>                <div class="input-group"><br>                    <input type="checkbox" name="ids" value="<s:property">&gt;<br>                </div><!-- /input-group --><br>            </div><!-- /.col-lg-6 --><br><br>        </td><br>        <td><s:property value="#s.id"></s:property></td><br>        <td><s:property value="#s.name"></s:property></td><br>        <td><s:property value="#s.gender"></s:property></td><br>        <td><s:property value="#s.job"></s:property></td><br>        <td><s:property value="#s.salary"></s:property></td><br>        <td><s:property value="#s.email"></s:property></td><br>        <td><s:date name="#s.regDate" format="yyyy-MM-dd"></s:date></td><br>        <!-- <td><button class="btn btn-info">修改</button></td> --><br>        <td></td><br>        <td><button class="btn btn-info" onclick="deleteStaffById(<s:property value=" #s.id"="">)">删除</button></td><br>    </tr><br></s:iterator><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">要实现循环，就要使用Struts2标签的iterator，然后在相应位置使用OGNL表达式来获取每一条数据</div><div class="line"></div><div class="line">因为在StaffAction类中的queryByPage方法中至调用了StaffService接口中的queryById方法，所以queryByPage方法的编码就完成了</div><div class="line"></div><div class="line">最后是修改execute()中的内容，基本和queryByPage方法中的内容一致</div></pre></td></tr></table></figure></p>
<p>/**</p>
<ul>
<li><p>初始化显示<br>*/<br>public String execute(){<br> int pageStart = 1;<br> List<staff> staffList = staffService.queryStaffList();<br> for(int i = 1; i &lt;= 5; i++){</staff></p>
<pre><code>list.add(staffList.get(pageStart));
pageStart = pageStart + 1;
if(pageStart == staffList.size()){
    break;
}
</code></pre><p> }</p>
<p> //传递页数和当前页<br> //1、获取值栈对象<br> ActionContext context = ActionContext.getContext();<br> ValueStack stack = context.getValueStack();</p>
<p> //2、调用值栈对象中的set方法<br> double sumPage = Math.ceil(staffList.size() / 5.0);<br> stack.set(“sumPage”, (int)sumPage);<br> stack.set(“currentPage”, 1);<br> return SUCCESS;<br>}<br>```</p>
</li>
</ul>
<p>至此，分页功能完成了，总体写的比较乱，因为还要进行改动，所以思路也比较乱</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/27/Java笔记之人员管理模块-四/" rel="next" title="Java笔记之人员管理模块(四)">
                <i class="fa fa-chevron-left"></i> Java笔记之人员管理模块(四)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/19/Java笔记之人员管理模块-六/" rel="prev" title="Java笔记之人员管理模块(六)">
                Java笔记之人员管理模块(六) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/touxiang.JPG"
               alt="Fzero" />
          <p class="site-author-name" itemprop="name">Fzero</p>
          <p class="site-description motion-element" itemprop="description">在迷踪岛满级的熊猫信仰贼</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#最初的列表页"><span class="nav-number">1.</span> <span class="nav-text">最初的列表页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现分页功能的思路"><span class="nav-number">2.</span> <span class="nav-text">实现分页功能的思路</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fzero</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  


  

  

  


</body>
</html>
